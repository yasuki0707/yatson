# このドキュメントについて
このドキュメントでは、以下の項目について説明しています。  
- 提出物
- 実行環境
  - 実行環境
  - 実行方法
- 拡張性について
- テストデータの検証プログラム
  - 音声データが指定の言語であるかどうかの判定
  - 指定した音声ファイルのサイズが設定した上限以内であるかを判定
- テスト
  - 単体テスト
  - 結合テスト

[GitHubリポジトリ](https://github.com/yasuki0707/yatson)を作成したため、設定その他詳細はそちらを参照ください。

---

# 提出物
- ソースコード: プロジェクトフォルダ(`src/`)
- Readme: `README.md`
- 説明資料: 本ドキュメント(`説明ドキュメント.md`)
- その他
  - 単体テスト: `src/__tests__/`
  - 結合テスト: `sh/test.sh`
  - テストデータ検証プログラム: `src/tools/`


# 実行環境
## 実行環境
node 及び npm のインストールが必要です。
以下のバージョンで動作確認済です。
```
$ node -v
v14.17.3

$ npm -v
6.14.13
```

## 実行方法
### 必要な設定
- IBM Cloud で Speech to Text サービス 及び Natural Language Understandingサービス[^1]インスタンスを作成
- リポジトリのクローン or アップロードしたプロジェクトの展開
- npm パッケージのインストール
- 環境ファイル(`.env`)の設定

[^1]: 音声ファイルの言語検証に使用します。詳細は[こちら](https://github.com/yasuki0707/yatson#language)

### プロジェクトのビルド
```
npm run tsc
```

### アプリケーションの実行
```
node ./dist/index.js <audio_file> <keyword1> <keyword2> <keyword3>...
```

詳細は[こちら](https://github.com/yasuki0707/yatson#setup-environment--run-the-application)を参照ください。

# 拡張性について
本課題における要件には含まれないが、今後想定される対応や変更箇所についてまとめます。
また、これらはソースコード内に`EXTENSION:`として記述しています。
- 音声ファイルから変換したテキストを処理する関数(`processText`)は、入力にテキストと検索キーワードを受け取ります。仮にテキストに全く別の処理を行う必要が出てきても、入力は共通で使用できるため、テキスト処理ロジックを記述するのみで良いです。
- 処理済みデータをCSVファイルへ変換・出力する関数(`outputToCsv`)は、出力すべき内容が変更になった場合でも関数自体に修正を加える必要はありません。この関数に渡されるデータの型を新しく定義するだけで、関数内で自動的にヘッダーの生成、データの変換を行います。
- 音声データが日本語であるかどうかの検証を`checkAudioLocale`関数で行っています。入力で指定する`text`と`locale`の言語が一致するかどうかの判定を行います。今回は日本語かどうかの判定を行うため`ja_JP`の指定となりますが、モデルの型を追加することで他の言語についても音声ファイルの言語と検証することができます。ただし、この機能には未実装部分があるため、詳細は`src/modules/CheckAudioLocal.ts#checkAudioLocale`内のTODOを参照ください。


# テストデータの検証プログラム
## 音声データが指定の言語であるかどうかの判定
### 指定した音声ファイルが日本語かを判定
```
npm run tool:audio:ja <audio_file>
```
- このコマンドのより一般的な使用方法により、指定した音声ファイルが指定した言語であるかどうかを判定します。
```
npm run tool:audio <locale> <audio_file>
```

### 指定した音声ファイルのサイズが設定した上限以内であるかを判定
```
npm run tool:audio:size <audio_file>
```


# テスト
## 単体テスト
以下の項目について単体テストを行います。
- テキスト処理のロジック
- 処理されたテキストをCSVデータに変換するロジック  

以下のコマンドでテストを実行します。
```
npm run test:ut
```

詳細は[こちら](https://github.com/yasuki0707/yatson#unit-test)を参照ください。

## 結合テスト
本アプリケーション実行時の以下の場合について正常に実行されるかをテストします。
- 音声ファイルと検索キーワードが正しく指定された場合
- 音声ファイルと検索キーワードが指定されていない場合
- 検索キーワードが指定されていない場合
- 音声ファイルが指定されていない場合
- 音声ファイルとして指定されたものが音声ファイルではない場合

詳細は[こちら](https://github.com/yasuki0707/yatson#intergration-test)を参照ください。
